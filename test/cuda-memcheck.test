#!./bats
# -*- mode: sh -*-

TEST="cuda-memcheck"
RUNFILE="inputs/input.dtconst.2iters.cyl.ini"

@test "[$TEST] verify cuda-memcheck detects known error" {
    test -e ./badcuda
    run /usr/local/cuda/bin/compute-sanitizer --error-exitcode 1 ./badcuda
    [[ "${status}" -eq 1 ]]
}

@test "[$TEST] run tps with input -> $RUNFILE under cuda-memcheck" {
    test -s $RUNFILE

    ../libtool --mode=execute /usr/local/cuda/bin/compute-sanitizer --error-exitcode 1 ../src/tps --runFile $RUNFILE
}

