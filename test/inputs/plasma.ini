#---------------------
# TPS runtime controls
#---------------------

# choice of solver
[solver]
type = flow
# type = cycle-avg-joule-coupled

# [cycle-avg-joule-coupled]
# solve-em-every-n = 10000
# max-iters = 20 #10000010
# timing-frequency = 1000
# axisymmetric = True
# input-power = 2500. #10000.
# initial-input-power = 2500. #10000.

# max-outer-iters = 1000 #600 #250
# axisymmetric = True
# initial-input-power = 17500.
# input-power = 17500.

#---------------------------------------
# Controls for flow solver
#---------------------------------------
[flow]
# mesh = ../../../../Documents/caseForMalamas/mesh/torch-flow-refine-step.msh
# mesh = ../../../../Desktop/tmp/lte-to-noneq-lowP/mesh/torch-flow-refine.msh
mesh = ../../../../Desktop/tmp/axisym-lte-y3/mesh/torch-flow-refine-step-inlet2.msh
order = 3
integrationRule = 0
basisType = 0
refinement_levels = 0
maxIters = 127600004 #551500010 #26500010  # Not used by cycle-avg-joule-coupled solver
outputFreq = 2 #100000
useRoe = 0
enableSummationByParts = 0
fluid = user_defined # supported fluid: dry_air, user_defined, lte_table
# lte/table_dim = 1
lte/thermo_table = ../../../../Desktop/tmp/lte-to-noneq-lowP/lte-data/thermo_table.dat
lte/e_rev_table = ../../../../Desktop/tmp/lte-to-noneq-lowP/lte-data/e_rev_table.dat
lte/transport_table = ../../../../Desktop/tmp/lte-to-noneq-lowP/lte-data/transp_table.dat
# lte/thermo_table = ../../../../Desktop/tmp/axisym-lte-y3/lte-data/argon_thermo_1atm.h5
# lte/e_rev_table = ../../../../Desktop/tmp/axisym-lte-y3/lte-data/e_rev_table.dat
# lte/transport_table = ../../../../Desktop/tmp/axisym-lte-y3/lte-data/argon_transport_1atm.h5
refLength = 1.
equation_system = navier-stokes
axisymmetric = True
timingFreq = 1000
# useNodalInterior = False

## new mixing length model settings
## by setting Pr_ratio = 0, kappa not affected by mixing length model
computeDistance = False
useMixingLength = False
mixing-length/max-mixing-length = 0.01
mixing-length/Pr_ratio = 0.0

[io]
outdirBase = output-plasma-refine2
# outdirBase = output-plasma
enableRestart = True
restartFromLTE = True
restartMode = singleFileReadWrite # supported restartMode: standard, variableP, singleFileWrite, singleFileRead, singleFileReadWrite
# exitCheckFreq = 500
saveTemperatureField = False

[time]
cfl = 0.0005 # 0.1
integrator = forwardEuler # rk2,rk3
# enableConstantTimestep = True

[viscosityMultiplierFunction]
isEnabled = True
norm = '0 1 0'
p0 = '0 0.46 0'
pInit = '0 0.46 0'
width = 0.02
viscosityRatio = 20.

#---------------------------------------
# Initial and Boundary Conditions
#---------------------------------------

[initialConditions]
rho = 1.632853e+00
rhoU = 0.0
rhoV = 1.1558
rhoW = 0.
pressure = 101325.

[boundaryConditions/wall1]
# Axis
patch = 2
type = inviscid

[boundaryConditions/wall2]
# Bottom wall
patch = 3
type = viscous_isothermal
temperature = 298.15

[boundaryConditions/wall3]
# Jet "wall"
patch = 5
type = slip

[boundaryConditions/wall4]
# Top wall
patch = 7
type = viscous_isothermal
temperature = 298.15

[boundaryConditions/wall5]
# Torch outer wall
patch = 8
type = viscous_isothermal
temperature = 298.15

[boundaryConditions/inlet1]
patch = 4
type = subsonic
density = 1.632853e+00
# for uniform profile
uvw = '0.0 0.706 40.0'
mass_fraction/species1 = 0.0
mass_fraction/species2 = 0.0 
mass_fraction/species3 = 0.0 
mass_fraction/species4 = 0.0 
mass_fraction/species5 = 0.0 
mass_fraction/species6 = 1.0 # 'Ar'

[boundaryConditions/outlet1]
patch = 6
type = subsonicPressure
pressure = 101325.0

[boundaryConditions]
numWalls = 5
numInlets = 1
numOutlets = 1
useBCinGrad = true

#---------------------------------------
# Spongezone
#---------------------------------------

[spongezone]
numSpongeZones = 0

[spongezone1]
isEnabled = True
type = planar
targetSolType = userDef
# targetSolType = mixedOut
density = 1.632853e+00
uvw = '0.0 0.0377256 0.0'
pressure = 101325.0
normal = '0 -1 0'
p0 = '0 0.5 0'
pInit = '0 0.45 0'
multiplier = 0.5
electron_temperature = 298.15
mass_fraction/species1 = 1.0 # 'Ar'
mass_fraction/species2 = 0.0 # 'E'
mass_fraction/species3 = 0.0 # 'Ar.+1'
mass_fraction/species4 = 0.0 # 'Ar_m'
mass_fraction/species5 = 0.0 # 'Ar_r'
mass_fraction/species6 = 0.0 # 'Ar_p'


#---------------------------------------
# Controls for plasma model
#---------------------------------------

[plasma_models]
ambipolar = True
two_temperature = False
electron_temp_ic = 300.0
gas_model = perfect_mixture 
chemistry_model = 'mass_action_law' # mass_action_law, cantera # not supported at the moment
const_plasma_conductivity = 0.0

[plasma_models]
transport_model = argon_mixture # supported transport_model: argon_minimal, argon_mixture, constant  
argon_ternary/third_order_thermal_conductivity = False

[plasma_models]
radiation_model = p1_model # supported radiation_model: none, net_emission, p1_model
visualization = False

[plasma_models/radiation_model/net_emission]
coefficient = tabulated
tabulated/filename = '../../../../Desktop/tmp/axisym-lte-y3/radiation_table/nec_sample.0.h5'
tabulated/x_log = False
tabulated/f_log = False
tabulated/order = 1

[plasma_models/radiation_model/p1_model]
num_of_groups = 2
solve-rad-every-n = 1
# timing-frequency = 1000
MaxIters = 100
P1_Tolerance = 1e-5
PrintLevels = 2
coefficient = tabulated
tabulated/path_to_files = './rad-data/'
tabulated/x_log = False
tabulated/f_log = False
tabulated/order = 1

#---------------------------------------
# Chemical Species
#---------------------------------------

[atoms]
numAtoms = 2

[atoms/atom1]
name = 'Ar'
mass = 39.948e-3 # [kg/mol]

[atoms/atom2]
name = 'E'
mass = 5.48579908782496e-7 # [kg/mol]

[species]
numSpecies = 6
background_index = 6
# electron_index = 2

[species/species1]
name = 'Ar_m'
composition = '{Ar : 1}'
formation_energy = 1116860.96186 # [J/mol]  =  11.5754 eV (weighted value such that n_m = the number densities of the two metastables) # (E_f = E_ev * spc.e * spc.N_A where E_f in [J/mol] and E_ev in [eV])   Exitation energy of metastables
level_degeneracy = 6
initialMassFraction = 0.0
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

[species/species2]
name = 'Ar_r'
composition = '{Ar : 1}'
formation_energy = 1130867.391486 # [J/mol]  =  11.7206 eV # Exitation energy of resonance levels
level_degeneracy = 6
initialMassFraction = 0.0
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

[species/species3]
name = 'Ar_p'
composition = '{Ar : 1}'
formation_energy = 1269949.8858896866 # [J/mol]  =  13.16210306730009 eV # Exitation energy of 4p levels
level_degeneracy = 36
initialMassFraction = 0.0
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

[species/species4]
name = 'Ar.+1'
composition = '{Ar : 1, E : -1}'
formation_energy = 1520571.3883  # [J/mol]  = 15.7596119 eV # Ionization energy (Not sure what the units should be here)
level_degeneracy = 4
initialMassFraction = 0.0
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

[species/species5]
name = 'E'
composition = '{E : 1}'
formation_energy = 0.0
level_degeneracy = 1
initialMassFraction = 0.0
initialElectronTemperature = 298.15
# if gas_model is perfect_mixture, requires heat capacities from input.
# molar heat capacities in unit of universal gas constant.
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

[species/species6]
name = 'Ar'
composition = '{Ar : 1}'
formation_energy = 0.0
level_degeneracy = 1
initialMassFraction = 1.0
perfect_mixture/constant_molar_cv = 1.5
perfect_mixture/constant_molar_cp = 2.5

#---------------------------------------
# Chemical Reactions
#---------------------------------------

[reactions]
number_of_reactions = 5
characteristic_length = 0.028

# [reactions/reaction1]
# equation = 'Ar + E <=> Ar.+1 + 2 E'
# reaction_energy = 1520571.3883 # [J/mol]
# reactant_stoichiometry = '1 1 0' # What is the order here? Is it based on the order we define the species in the input file?
# product_stoichiometry = '0 2 1'  # '2 0 1' 
# model = arrhenius
# arrhenius/A = 4.7
# arrhenius/b = 1.2
# arrhenius/E = 6.49e4
# detailed_balance = True
# equilibrium_constant/A = 1.39
# equilibrium_constant/b = 0.7
# equilibrium_constant/E = 6.197e2


[reactions/reaction1]
equation = 'Ar + E <=> Ar.+1 + 2 E'
reaction_energy = 1520571.3883 # [J/mol]
reactant_stoichiometry = '0 0 0 0 1 1' 
product_stoichiometry = '0 0 0 1 2 0'  
model = arrhenius
arrhenius/A = 74072.331348
arrhenius/b = 1.511
arrhenius/E = 1176329.772504 # [J/mol]

[reactions/reaction2]
equation = 'Ar.+1 + 2 E <=> Ar + E'
reaction_energy = -1520571.3883 # [J/mol] # Should it be negative?
reactant_stoichiometry = '0 0 0 1 2 0' 
product_stoichiometry = '0 0 0 0 1 1' 
model = arrhenius
arrhenius/A = 34126.4747526  
arrhenius/b = 0.368
arrhenius/E = -377725.908714 # [J/mol]

[reactions/reaction3]
equation = 'Ar_r <=> Ar'
reaction_energy = -1130867.391486 # [J/mol] # Should it be negative?
reactant_stoichiometry = '0 1 0 0 0 0' 
product_stoichiometry = '0 0 0 0 0 1' 
model = radiative_decay

[reactions/reaction4]
equation = 'Ar_p <=> Ar_r'
reaction_energy = -139082.4944036866 # [J/mol]
reactant_stoichiometry = '0 0 1 0 0 0' 
product_stoichiometry = '0 1 0 0 0 0' 
model = radiative_decay

[reactions/reaction5]
equation = 'Ar_p <=> Ar_m'
reaction_energy = -153088.92402968672 # [J/mol]
reactant_stoichiometry = '0 0 1 0 0 0' 
product_stoichiometry = '1 0 0 0 0 0' 
model = radiative_decay

#---------------------------------------
# Controls for EM-only solver           
#---------------------------------------

[em]
# mesh = ../mesh/torch-em-coarse2.msh
# mesh = ../../../../Desktop/tmp/lte-to-noneq-lowP/mesh/torch-em-coarse2.msh
mesh = ../../../../Desktop/tmp/axisym-lte-y3/mesh/torch-em-coarse2.msh
order       =  3                 # FE order (polynomial degree)
ref_levels  =  0
max_iter    =  1000              # max number of iterations
rtol        =  1.0e-12           # solver relative tolerance
atol        =  1.0e-18           # solver absolute tolerance
top_only    =  false             # run current through top branch only
bot_only    =  false             # run current through bottom branch only
yinterp_min = -2.0               # minimum y interpolation value         
yinterp_max =  2.0               # maximum y interpolation value         
nBy         =  129               # of interpolation points               
By_file     =  ref_solns/By.h5   # file for By interpolant output        
# current_amplitude = 2e6        # run 0 of heating # A/m^2               
# current_amplitude = 3e6        # run 1 of heating # A/m^2 (with reactions
current_amplitude = 4e6          # A/m^2 (when power is set, this isn't so relevant)
current_frequency = 6e6          # 1/s
permeability = 1.25663706e-6     # m * kg / s^2 / A^2